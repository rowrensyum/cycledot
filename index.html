<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>recurring_decimal</title>
</head>
<body>
    <input type="number" id="son" placeholder="분자" min="1">
    <span>/</span>
    <input type="number" id="mom" placeholder="분모" min="1">
    <button id="submit" type="button">확인</button>

    <p id="str"></p>
    <p id="mane"></p>
    <p id="result"></p>

    <script>
       document.getElementById('submit').addEventListener('click', function() {

            let son = parseInt(document.getElementById("son").value);
            let mom = parseInt(document.getElementById("mom").value);

            if (!son || !mom || mom === 0) {
                document.getElementById("result").innerText = "분모는 0이 될 수 없습니다!";
                return;
            }

            let a = []; // 몫 저장
            let c = []; // 나머지 저장

            let num = Math.floor(son / mom); // 몫
            let tsh2 = son % mom;            // 나머지

            a.push(num);

            i = 0;

            document.getElementById("str").innerHTML = "<b>" + son + "/" + mom + "=" + num +"..." + tsh2 + "</b>";   

            while(tsh2 !== 0 && !c.includes(tsh2)) {
                son = tsh2 * 10;
                num = Math.floor(son / mom);
                a.push(num);
                c.push(tsh2);
                tsh2 = son % mom;
            }

            son = tsh2 * 10;
                num = Math.floor(son / mom);
                a.push(num);
                c.push(tsh2);
                tsh2 = son % mom

            console.log(a);
            console.log(c);

            // 단순 소수인지 확인
            if(c.includes(0)) {
                document.getElementById("result").innerHTML = "<b>" + a[0] + "." + a.slice(1).join('') + "</b>";
                return;
            }
            
            let maneStr = "";
            for(let i = 1; i < c.length+1; i++){
                maneStr += "<b>" + c[i-1]*10 + "/" + mom + "=" + a[i] +"..." + c[i]+ "</b><br>";
            }
            document.getElementById("mane").innerHTML = maneStr;

            // 반복 소수 처리
            let dup = num; // 반복 시작 나머지
            a.pop();
            let place = a.indexOf(num); // 반복 시작 위치

            let num1 = a[0];                 // 정수 부분
            let numbo = a.slice(1, place); // 반복 시작 전 소수

            let num2 = a[place] || "";          // 반복 시작 몫
            
            let suba = a.slice(place+1,a.length-1) || [];    // 반복 구간 나머지

            let num3 = a[a.length-1] || "";
            
            if(numbo.length === 0) { // 반복 1자리
             document.getElementById("result").innerHTML =
             "<b>" + num1 + ".<ruby>" + num2 + "<rp>(</rp><rt>•</rt><rp>)</rp></ruby></b>";
            } else {
               document.getElementById("result").innerHTML =
                "<b>" + num1 + "." + numbo.join('') +
                "<ruby>" + num2 + "<rp>(</rp><rt>•</rt><rp>)</rp></ruby>" +
                suba.join('') +
             "<ruby>" + num3 + "<rp>(</rp><rt>•</rt><rp>)</rp></ruby></b>";
           } 

           
        });
    </script>
</body>
</html>
